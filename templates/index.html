<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drone Mission Control</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Drone Mission Control</h1>
            <div class="flight-status">
                <span id="flight-status-indicator"
                      class="indicator"
                      data-connection="offline"
                      title="Connection Status"></span>
                Drone Status
                <span id="mqtt-status-indicator"
                      class="indicator"
                      data-connection="offline"
                      title="MQTT Connection"
                      style="margin-left: 20px;"></span>
                MQTT
                <a href="/map" style="margin-left: 20px; text-decoration: none; background-color: #3498db; color: white; padding: 8px 15px; border-radius: 4px;">Mapa</a>
                <a href="/logout" style="margin-left: 20px; color: white; text-decoration: none; background-color: #e74c3c; padding: 8px 15px; border-radius: 4px;">Logout</a>
            </div>
        </header>

        <div class="dashboard">
            <!-- ========================= DRONE STATUS ======================== -->
            <section class="status-panel panel">
                <h2>Drone Status</h2>
                <table>
                    <tr><th>Height</th>          <td id="altitude">0.0</td></tr>
                    <tr><th>Speed</th>           <td id="speed">0.0</td></tr>
                    <tr><th>Battery percent</th> <td id="battery_percent">100%</td></tr>
                    <tr><th>Battery voltage</th> <td id="battery_voltage">0V</td></tr>
                    <tr><th>GPS GLOBAL</th>      <td id="gps_global">0.0,0.0</td></tr>
                    <tr><th>GPS RELATIVE</th>    <td id="gps_relative">0.0,0.0</td></tr>
                    <tr><th>Mission time</th>    <td id="mission_time">00:00:00</td></tr>
                    <tr><th>Flight mode</th>     <td id="flight_mode">INIT</td></tr>
                    <tr><th>Last update</th>     <td id="last_update">-</td></tr>
                </table>
            </section>

            <!-- ========================= CAMERA IMAGE ======================= -->
            <section class="image-panel panel">
                <h2>Latest Image</h2>
                <div class="image-container">
                    <img id="drone-image" src="/static/placeholder.png" alt="Drone Camera Feed">
                    <div class="image-meta">
                        <span id="image-timestamp">No image received</span>
                        <span id="image-size">-</span>
                    </div>
                </div>
                <!-- Gallery thumbnails will be injected here -->
                <div class="gallery-container" id="gallery-container"></div>
            </section>

            <!-- ========================= LIVE VIDEO STREAM =================== -->
            <div class="camera-view-container panel">
                <h3>Widok kamery na żywo</h3>
                <img id="live-video" src="/video_feed"
                     alt="Live stream">
            </div>

            <!-- ========================= MISSION LOG ======================== -->
            <section class="log-panel panel">
                <h2>Mission Log <span id="log-counter" style="font-size: 0.8em; color: #7f8c8d; margin-left: 10px;">(0)</span></h2>
                <div class="log-controls">
                    <button id="clear-gallery">Clear gallery</button>
                    <button id="clear-log">Clear</button>
                </div>
                <div class="log-container" id="mission-log"></div>
            </section>
        </div> <!-- /dashboard -->
    </div> <!-- /container -->

    <div id="error-display" class="error-display hidden"></div>

    <!-- Socket.IO client (musi być przed script.js) -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js" crossorigin="anonymous"></script>
    <!-- Twój główny skrypt -->
    <script src="/static/script.js"></script>

</body>
</html>
